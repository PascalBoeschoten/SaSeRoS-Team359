#define SENSOR_TOUCH_FRONT_IN IN_1
#define LIGHT_SENSOR_IN IN_2
#define SENSOR_TOUCH_BACK_IN IN_3
#define SENSOR_LIGHT_EDGE_IN IN_4

#define MOTOR_RIGHT_OUT OUT_A
#define MOTOR_LEFT_OUT OUT_B
#define ULTRASONIC_THRESHOLD 30

#include "../basic_functions/functions.h"
#include "../scanner.h"
#include "../edge_detection.h"

// Task for testing the touch sensor readout
task read_touch_sensor() {
    SetSensorTouch(SENSOR_TOUCH_FRONT_IN);

    while(true){
        if(Sensor(SENSOR_TOUCH_FRONT_IN) == 1) {
            OnFwd(OUT_AC, 100);
        }
        else {
            Off(OUT_AC);
        }
    }
}

// Just empty for now. Should turn a certain amount of degrees.
void turnDegrees(int degrees) {
    ;
}

// Task for testing ultrasonic sensor readout
task read_ultrasonic_sensor() {
    SetSensorUltrasonic(ULTRASONIC_IN);
    
    while(true){
        //the ultrasonic sensor needs time to read the values
        //that is why we have the wait
        Wait(500);
        ClearScreen();
        NumOut(0, 0, SensorUS(ULTRASONIC_IN));
    }
}

// Task that beeps every second so you know the system
// is running
task heartbeat() {
    while(true) {
        PlayTone(500, 100);
        Wait(5000);
    }
}

// Task for testing the light sensor
task light_sensor() {
    Light_Sens_Init(SENSOR_LIGHT_EDGE_IN);
        
    while(true){
        Wait(300);
        ClearScreen();

        NumOut(0,0, SENSOR_4);
    }
}

// Task for testing scanning
task scanning() {
     int scan_value = 0;
     while(true) {
        ClearScreen();
        TextOut(0,0,"Starting scan...");
        Wait(300);
        scan_value = UltrasonicScan();
        TurnRobot(scan_value, 50);
     }
}

task main() {

     start heartbeat;

}
